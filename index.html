<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‰ 20 ×™××™ ×—×’×™×’×”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #36393F 0%, #2C2F33 50%, #1E1F22 100%);
            color: white;
            min-height: 100vh;
        }

        /* Login Screen */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #5865F2 0%, #4752C4 50%, #36393F 100%);
        }

        .login-container {
            text-align: center;
            max-width: 500px;
            space-y: 30px;
        }

        .login-container h1 {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .login-container p {
            font-size: 20px;
            margin-bottom: 20px;
            color: #e0e0e0;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
        }

        .login-box p {
            margin-bottom: 20px;
        }

        .login-btn {
            width: 100%;
            background: white;
            color: #5865F2;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .login-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .feature {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .feature-emoji {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .feature p {
            font-size: 14px !important;
            margin: 0 !important;
        }

        /* Main App */
        .app-screen {
            display: none;
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(44, 47, 51, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 900;
        }

        .header-score {
            background: rgba(88, 101, 242, 0.2);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            display: none;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .username {
            display: none;
            text-align: right;
            font-size: 14px;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        /* Calendar Grid */
        .calendar-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 16px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .calendar-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 12px;
            }
        }

        @media (max-width: 480px) {
            .calendar-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
        }

        .day-button {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #5865F2, #4752C4);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(88, 101, 242, 0.3);
            position: relative;
            overflow: hidden;
        }

        .day-button:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(88, 101, 242, 0.5);
        }

        .day-button:active:not(:disabled) {
            transform: scale(0.95);
        }

        .day-button:disabled {
            background: #4a4d51;
            opacity: 0.5;
            cursor: not-allowed;
        }

        .day-button.completed {
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.6);
            border: 3px solid #22c55e;
            background: linear-gradient(135deg, #16a34a, #15803d);
        }

        .day-number {
            font-size: 32px;
            font-weight: 900;
        }

        .day-emoji {
            font-size: 20px;
        }

        .day-time {
            font-size: 10px;
            opacity: 0.8;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #36393F;
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #5865F2, #4752C4);
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-btn:hover {
            transform: rotate(90deg);
        }

        .modal-content {
            padding: 30px;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            height: 0;
            margin-bottom: 20px;
            background: black;
            border-radius: 12px;
            overflow: hidden;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .continue-btn {
            width: 100%;
            background: linear-gradient(135deg, #5865F2, #4752C4);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(88, 101, 242, 0.4);
        }

        .questions-container {
            space-y: 30px;
        }

        .question {
            margin-bottom: 30px;
        }

        .question-text {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #e0e0e0;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: #2C2F33;
            border: 2px solid transparent;
            color: white;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: right;
            font-weight: 500;
        }

        .option:hover {
            background: #404249;
            border-color: #5865F2;
        }

        .option.selected {
            background: #5865F2;
            border-color: white;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .success-message {
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid #22c55e;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        .success-title {
            font-size: 24px;
            font-weight: bold;
            color: #4ade80;
            margin-bottom: 10px;
        }

        .success-points {
            font-size: 18px;
            color: #86efac;
        }

        .riddle-input {
            width: 100%;
            background: #2C2F33;
            border: 2px solid #404249;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .riddle-input:focus {
            outline: none;
            border-color: #5865F2;
            box-shadow: 0 0 10px rgba(88, 101, 242, 0.3);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <h1>ğŸ‰ 20 ×™××™ ×—×’×™×’×”</h1>
            <p>×ª×—×¨×•×ª ×¢×œ ×”×©×¨×ª ×©×œ× ×•</p>
            
            <div class="login-box">
                <p>×›×“×™ ×œ×”×ª×—×™×œ ××ª ×”×”×¨×¤×ª×§×”, ×”×ª×—×‘×¨ ×¢× Discord</p>
                <button class="login-btn" onclick="loginWithDiscord()" style="background: #5865F2; color: white;">
                    <span style="margin-right: 10px;">ğŸ®</span> ×”×ª×—×‘×¨×•×ª ×¢× Discord
                </button>
            </div>

            <div class="features">
                <div class="feature">
                    <div class="feature-emoji">ğŸ“…</div>
                    <p>20 ×™××™×</p>
                </div>
                <div class="feature">
                    <div class="feature-emoji">ğŸ®</div>
                    <p>××©×—×§×™×</p>
                </div>
                <div class="feature">
                    <div class="feature-emoji">ğŸ†</div>
                    <p>× ×™×§×•×“</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-screen" id="appScreen">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-title">
                    ğŸ‰ 20 ×™××™ ×—×’×™×’×”
                </div>
                <div class="header-score" id="headerScore">
                    × ×™×§×•×“: <span id="totalScore">0</span>
                </div>
                <div class="header-right">
                    <div class="username" id="headerUsername"></div>
                    <button class="logout-btn" onclick="logout()">×”×ª× ×ª×§×•×ª</button>
                </div>
            </div>
        </div>

        <!-- Calendar -->
        <div class="calendar-container">
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">×™×•× 1</div>
                <button class="close-btn" onclick="closeModal()">âœ•</button>
            </div>
            <div class="modal-content">
                <div id="videoStep">
                    <div class="video-container" id="videoContainer"></div>
                    <button class="continue-btn" onclick="showGameStep()">
                        â–¶ï¸ ×”××©×š ×œ××©×—×§
                    </button>
                </div>
                <div id="gameStep" style="display: none;">
                    <div id="questionsContainer"></div>
                    <button class="submit-btn" id="submitBtn" onclick="submitAnswer()">
                        ğŸ† ×©×œ×— ×ª×©×•×‘×”
                    </button>
                    <div class="success-message" id="successMessage">
                        <div class="success-title">âœ“ ××¢×•×œ×”!</div>
                        <div class="success-points" id="successPoints"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ====== CONFIGURATION - EDIT THIS! ======
        const DAYS = [
            {
                day: 1,
                title: '×ª×—×™×œ×ª ×”××¡×¢',
                emoji: 'ğŸš€',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'quiz',
                questions: [
                    { q: '××” ×©× ×”×©×¨×ª ×©×œ× ×•?', opts: ['×©×1', '×©×2', '×©×3'], correct: 0 },
                    { q: '×›××” ×—×‘×¨×™× ×‘×©×¨×ª?', opts: ['100', '200', '500'], correct: 1 },
                ],
                points: 100,
            },
            {
                day: 2,
                title: '×™×•× ×©× ×™',
                emoji: 'â­',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'riddle',
                content: '×›××” ××¦×‘×¢×•×ª ×™×© ×‘×©×ª×™ ×™×“×™×™×?',
                answer: '10',
                points: 150,
            },
            // ===== ×”×•×¡×£ ×¢×•×“ 18 ×™××™× ×›××Ÿ =====
            {
                day: 3,
                title: '×™×•× ×©×œ×™×©×™',
                emoji: 'ğŸ®',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'quiz',
                questions: [
                    { q: '×©××œ×” 1?', opts: ['A', 'B', 'C'], correct: 0 },
                ],
                points: 100,
            },
            {
                day: 4,
                title: '×™×•× ×¨×‘×™×¢×™',
                emoji: 'ğŸ¯',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'riddle',
                content: '×©××œ×”?',
                answer: '×ª×©×•×‘×”',
                points: 150,
            },
            {
                day: 5,
                title: '×™×•× ×—××™×©×™',
                emoji: 'ğŸŒŸ',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'quiz',
                questions: [
                    { q: '×©××œ×”?', opts: ['A', 'B', 'C'], correct: 1 },
                ],
                points: 100,
            },
            {
                day: 6,
                title: '×™×•× ×©×™×©×™',
                emoji: 'ğŸ¨',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'riddle',
                content: '×©××œ×”?',
                answer: '×ª×©×•×‘×”',
                points: 200,
            },
            {
                day: 7,
                title: '×™×•× ×©×‘×™×¢×™',
                emoji: 'ğŸª',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'quiz',
                questions: [
                    { q: '×©××œ×”?', opts: ['A', 'B', 'C'], correct: 0 },
                ],
                points: 150,
            },
            {
                day: 8,
                title: '×™×•× ×©××™× ×™',
                emoji: 'ğŸš€',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'riddle',
                content: '×©××œ×”?',
                answer: '×ª×©×•×‘×”',
                points: 150,
            },
            {
                day: 9,
                title: '×™×•× ×ª×©×™×¢×™',
                emoji: 'âš¡',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'quiz',
                questions: [
                    { q: '×©××œ×”?', opts: ['A', 'B', 'C'], correct: 2 },
                ],
                points: 100,
            },
            {
                day: 10,
                title: '×™×•× ×¢×©×™×¨×™',
                emoji: 'ğŸ†',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'riddle',
                content: '×©××œ×”?',
                answer: '×ª×©×•×‘×”',
                points: 250,
            },
            {
                day: 11,
                title: '×™×•× ××—×“ ×¢×©×¨',
                emoji: 'ğŸ’',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'quiz',
                questions: [
                    { q: '×©××œ×”?', opts: ['A', 'B', 'C'], correct: 0 },
                ],
                points: 100,
            },
            {
                day: 12,
                title: '×™×•× ×©× ×™× ×¢×©×¨',
                emoji: 'ğŸ­',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'riddle',
                content: '×©××œ×”?',
                answer: '×ª×©×•×‘×”',
                points: 150,
            },
            {
                day: 13,
                title: '×™×•× ×©×œ×•×©×” ×¢×©×¨',
                emoji: 'ğŸŒˆ',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'quiz',
                questions: [
                    { q: '×©××œ×”?', opts: ['A', 'B', 'C'], correct: 1 },
                ],
                points: 100,
            },
            {
                day: 14,
                title: '×™×•× ××¨×‘×¢×” ×¢×©×¨',
                emoji: 'ğŸ¯',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'riddle',
                content: '×©××œ×”?',
                answer: '×ª×©×•×‘×”',
                points: 150,
            },
            {
                day: 15,
                title: '×™×•× ×—××™×©×” ×¢×©×¨',
                emoji: 'ğŸŒŸ',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'quiz',
                questions: [
                    { q: '×©××œ×”?', opts: ['A', 'B', 'C'], correct: 2 },
                ],
                points: 100,
            },
            {
                day: 16,
                title: '×™×•× ×©×™×©×” ×¢×©×¨',
                emoji: 'ğŸª',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'riddle',
                content: '×©××œ×”?',
                answer: '×ª×©×•×‘×”',
                points: 200,
            },
            {
                day: 17,
                title: '×™×•× ×©×‘×¢×” ×¢×©×¨',
                emoji: 'ğŸš€',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'quiz',
                questions: [
                    { q: '×©××œ×”?', opts: ['A', 'B', 'C'], correct: 0 },
                ],
                points: 100,
            },
            {
                day: 18,
                title: '×™×•× ×©××•× ×” ×¢×©×¨',
                emoji: 'â­',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'riddle',
                content: '×©××œ×”?',
                answer: '×ª×©×•×‘×”',
                points: 150,
            },
            {
                day: 19,
                title: '×™×•× ×ª×©×¢×” ×¢×©×¨',
                emoji: 'ğŸ’«',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'quiz',
                questions: [
                    { q: '×©××œ×”?', opts: ['A', 'B', 'C'], correct: 1 },
                ],
                points: 100,
            },
            {
                day: 20,
                title: '×”×’×“×•×œ ×”×’××¨',
                emoji: 'ğŸ‰',
                videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                gameType: 'quiz',
                questions: [
                    { q: '×¡×™×™×× ×•?', opts: ['×›×Ÿ!', '×œ×', '××•×œ×™'], correct: 0 },
                ],
                points: 500,
            },
        ];
        // ====== END CONFIGURATION ======

        // Discord OAuth Configuration
        const DISCORD_CLIENT_ID = '1474379665606049998';
        const DISCORD_REDIRECT_URI = window.location.origin;

        function loginWithDiscord() {
            const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(DISCORD_REDIRECT_URI)}&response_type=code&scope=identify%20guilds`;
            window.location.href = authUrl;
        }

        function login() {
            const username = document.getElementById('usernameInput').value.trim();
            if (username) {
                currentUser = username;
                localStorage.setItem('currentUser', username);
                showApp();
            }
        }

        // Check for Discord OAuth callback
        async function handleDiscordCallback() {
            const params = new URLSearchParams(window.location.search);
            const code = params.get('code');

            if (code) {
                try {
                    // Get the token from Discord
                    const response = await fetch('https://discord.com/api/oauth2/token', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: new URLSearchParams({
                            client_id: DISCORD_CLIENT_ID,
                            code: code,
                            grant_type: 'authorization_code',
                            redirect_uri: DISCORD_REDIRECT_URI,
                        }),
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const userResponse = await fetch('https://discord.com/api/users/@me', {
                            headers: { Authorization: `Bearer ${data.access_token}` },
                        });

                        if (userResponse.ok) {
                            const user = await userResponse.json();
                            currentUser = user.username || user.id;
                            localStorage.setItem('currentUser', currentUser);
                            localStorage.setItem('discordUser', JSON.stringify(user));
                            
                            // Clean the URL
                            window.history.replaceState({}, document.title, window.location.pathname);
                            
                            showApp();
                        }
                    }
                } catch (error) {
                    console.error('Discord login error:', error);
                    alert('×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª ×¢× Discord');
                }
            }
        }

        function logout() {
            currentUser = null;
            selectedAnswer = null;
            localStorage.removeItem('currentUser');
            scores = {};
            completedDays = {};
            localStorage.removeItem('scores');
            localStorage.removeItem('completedDays');
            document.getElementById('usernameInput').value = '';
            showLogin();
        }

        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appScreen').style.display = 'none';
        }

        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appScreen').style.display = 'block';
            document.getElementById('headerUsername').textContent = currentUser;
            document.getElementById('headerUsername').style.display = 'block';
            document.getElementById('headerScore').style.display = 'block';
            renderCalendar();
        }

        function isDayUnlocked(dayNum) {
            const now = new Date();
            const today = now.getDate();
            const hour = now.getHours();

            if (dayNum < today) return true;
            if (dayNum === today && hour >= 16) return true;
            return false;
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            DAYS.forEach(day => {
                const isUnlocked = isDayUnlocked(day.day);
                const isCompleted = completedDays[day.day];

                const btn = document.createElement('button');
                btn.className = 'day-button' + (isCompleted ? ' completed' : '');
                btn.disabled = !isUnlocked;

                if (isCompleted) {
                    btn.innerHTML = `
                        <div class="day-emoji">âœ“</div>
                        <div class="day-number">${day.day}</div>
                    `;
                } else if (isUnlocked) {
                    btn.innerHTML = `
                        <div class="day-emoji">${day.emoji}</div>
                        <div class="day-number">${day.day}</div>
                    `;
                    btn.onclick = () => openDay(day);
                } else {
                    btn.innerHTML = `
                        <div class="day-emoji">ğŸ”’</div>
                        <div class="day-number">${day.day}</div>
                        <div class="day-time">16:00</div>
                    `;
                }

                grid.appendChild(btn);
            });

            updateScore();
        }

        function updateScore() {
            const total = Object.values(scores).reduce((a, b) => a + b, 0);
            document.getElementById('totalScore').textContent = total;
        }

        function openDay(day) {
            currentDay = day;
            selectedAnswer = null;
            document.getElementById('modalTitle').textContent = `×™×•× ${day.day}: ${day.title}`;
            document.getElementById('videoContainer').innerHTML = `<iframe src="${day.videoUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            
            document.getElementById('videoStep').style.display = 'block';
            document.getElementById('gameStep').style.display = 'none';
            document.getElementById('successMessage').classList.remove('show');
            document.getElementById('submitBtn').disabled = false;

            document.getElementById('modalOverlay').classList.add('active');
        }

        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay')) return;
            document.getElementById('modalOverlay').classList.remove('active');
            currentDay = null;
            selectedAnswer = null;
        }

        function showGameStep() {
            document.getElementById('videoStep').style.display = 'none';
            document.getElementById('gameStep').style.display = 'block';

            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';

            if (currentDay.gameType === 'quiz') {
                currentDay.questions.forEach((q, idx) => {
                    const qDiv = document.createElement('div');
                    qDiv.className = 'question';
                    qDiv.innerHTML = `
                        <div class="question-text">${idx + 1}. ${q.q}</div>
                        <div class="options">
                            ${q.opts.map((opt, optIdx) => `
                                <button class="option" onclick="selectOption(${idx}, ${optIdx})">
                                    ${opt}
                                </button>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(qDiv);
                });
            } else if (currentDay.gameType === 'riddle') {
                container.innerHTML = `
                    <div class="question-text">${currentDay.content}</div>
                    <input type="text" class="riddle-input" id="riddleAnswer" placeholder="×ª×©×•×‘×ª×š...">
                `;
            }
        }

        function selectOption(questionIdx, optionIdx) {
            selectedAnswer = optionIdx;
            const options = document.querySelectorAll('.question:nth-child(' + (questionIdx + 1) + ') .option');
            options.forEach((opt, idx) => {
                opt.classList.toggle('selected', idx === optionIdx);
            });
        }

        function submitAnswer() {
            let isCorrect = false;

            if (currentDay.gameType === 'quiz') {
                // Simple check - first question's answer
                const firstQuestion = currentDay.questions[0];
                isCorrect = selectedAnswer === firstQuestion.correct;
            } else if (currentDay.gameType === 'riddle') {
                const answer = document.getElementById('riddleAnswer').value.trim();
                isCorrect = answer.toLowerCase() === currentDay.answer.toLowerCase();
            }

            if (isCorrect || currentDay.gameType === 'riddle') {
                completedDays[currentDay.day] = true;
                scores[currentDay.day] = currentDay.points;
                localStorage.setItem('scores', JSON.stringify(scores));
                localStorage.setItem('completedDays', JSON.stringify(completedDays));

                document.getElementById('submitBtn').disabled = true;
                document.getElementById('successPoints').textContent = `+${currentDay.points} × ×§×•×“×•×ª`;
                document.getElementById('successMessage').classList.add('show');

                setTimeout(() => {
                    closeModal();
                    renderCalendar();
                }, 2000);
            } else {
                alert('×ª×©×•×‘×” ×©×’×•×™×”! × ×¡×” ×©×•×‘.');
            }
        }

        // Initialize
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
            currentUser = savedUser;
            showApp();
        } else {
            showLogin();
        }

        // Check for Discord OAuth callback
        handleDiscordCallback();
    </script>
</body>
</html>
